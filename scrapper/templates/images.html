{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>My Scraped Products - Price Comparison</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#ff6b35',
            primary2: '#e55a2b',
            secondary: '#2c3e50',
            accent: '#3498db',
            successc: '#27ae60',
            warningc: '#f39c12',
            light: '#f8f9fa',
            dark: '#6c757d',
            borderc: '#e9ecef'
          },
          boxShadow: {
            card: '0 5px 15px rgba(0,0,0,0.08)',
            hovercard: '0 10px 25px rgba(0,0,0,0.15)'
          },
          backgroundImage: {
            'grad-primary': 'linear-gradient(135deg, #ff6b35, #e55a2b)',
            'btn-grad': 'linear-gradient(45deg, #ff6b35, #e55a2b)'
          }
        }
      }
    }
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body class="bg-light font-[Segoe_UI,Tahoma,Geneva,Verdana,sans-serif]">
  <!-- Navigation -->
  <nav class="bg-grad-primary shadow-md">
    <div class="max-w-6xl mx-auto px-6 py-3 flex items-center justify-between">
      <a class="text-white font-bold text-2xl" href="{% url 'index' %}">
        <i class="fas fa-search-dollar"></i> Product Scraper
      </a>
      <button id="navToggle" class="md:hidden text-white" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        <span class="fas fa-bars"></span>
      </button>
      <div id="navbarResponsive" class="hidden md:block w-full md:w-auto md:ml-auto">
        <ul class="md:flex md:items-center md:space-x-6 text-right md:text-left">
          <li class="my-2 md:my-0">
            <a class="text-white font-medium hover:text-white/90" href="{% url 'index' %}">
              <i class="fas fa-home"></i> Home
            </a>
          </li>
          <li class="my-2 md:my-0">
            <a class="text-white font-medium hover:text-white/90" href="{% url 'images' %}">
              <i class="fas fa-shopping-bag"></i> My Products
            </a>
          </li>
          {% if user.is_authenticated %}
          <li class="my-2 md:my-0">
            <a class="text-white font-medium hover:text-white/90" href="{% url 'logout' %}">
              <i class="fas fa-sign-out-alt"></i> Logout
            </a>
          </li>
          {% else %}
          <li class="my-2 md:my-0">
            <a class="text-white font-medium hover:text-white/90" href="{% url 'login' %}">
              <i class="fas fa-sign-in-alt"></i> Login
            </a>
          </li>
          <li class="my-2 md:my-0">
            <a class="text-white font-medium hover:text-white/90" href="{% url 'register' %}">
              <i class="fas fa-user-plus"></i> Signup
            </a>
          </li>
          {% endif %}
        </ul>
      </div>
    </div>
  </nav>

  <!-- Page Header -->
  <div class="bg-white border-b border-borderc">
    <div class="max-w-6xl mx-auto px-6 py-8">
      <div class="flex flex-col md:flex-row md:items-center">
        <div class="md:w-2/3">
          <h1 class="text-3xl font-bold text-secondary mb-2">My Scraped Products</h1>
          <p class="text-dark">Track and compare prices across multiple retailers</p>
        </div>
        <div class="md:w-1/3 md:text-right mt-4 md:mt-0">
          <a href="/" class="inline-flex items-center bg-btn-grad text-white rounded-full py-3 px-5 font-semibold hover:shadow-[0_5px_15px_rgba(255,107,53,0.4)] transition-shadow">
            <i class="fas fa-plus mr-2"></i> Scrape New Product
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Stats Section -->
  <div class="max-w-6xl mx-auto px-6 py-6">
    <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
      <div class="bg-white rounded-2xl p-6 text-center shadow-card">
        <div class="text-primary text-4xl font-bold">{{ products|length }}</div>
        <div class="text-dark">Total Products</div>
      </div>
      <div class="bg-white rounded-2xl p-6 text-center shadow-card">
        <div class="text-primary text-4xl font-bold">{{ products|length }}</div>
        <div class="text-dark">Active Tracking</div>
      </div>
      <div class="bg-white rounded-2xl p-6 text-center shadow-card">
        <div class="text-primary text-4xl font-bold">0</div>
        <div class="text-dark">Price Alerts</div>
      </div>
      <div class="bg-white rounded-2xl p-6 text-center shadow-card">
        <div class="text-primary text-4xl font-bold">₹0</div>
        <div class="text-dark">Total Savings</div>
      </div>
    </div>
  </div>

  <!-- Products Display -->
  <div class="max-w-6xl mx-auto px-6">
    {% if products %}
      <!-- Products Grid -->
      <div class="grid gap-6 justify-center" style="grid-template-columns: repeat(auto-fit, minmax(350px, 350px));">
        {% for product in products %}
        <div class="max-w-[350px]">
          <div class="bg-white rounded-2xl border border-borderc shadow-card hover:shadow-hovercard transition-transform duration-200 hover:-translate-y-1 flex flex-col h-full w-full">
            <!-- Product Image -->
            <div class="relative h-[200px] overflow-hidden bg-light">
              <a href="{% url 'product_detail' product.id %}" class="block h-full">
                {% if product.image_url %}
                  <img src="{{ product.image_url }}" class="w-full h-full object-contain bg-white" alt="{{ product.product_name }}" 
                       onload="this.style.display='block'; this.nextElementSibling.style.display='none';"
                       onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                  <div class="hidden items-center justify-center h-full bg-gradient-to-br from-[#f8f9fa] to-[#e9ecef] text-dark">
                    <i class="fas fa-image text-4xl opacity-50"></i>
                  </div>
                {% else %}
                  <div class="flex items-center justify-center h-full bg-gradient-to-br from-[#f8f9fa] to-[#e9ecef] text-dark">
                    <i class="fas fa-image text-4xl opacity-50"></i>
                  </div>
                {% endif %}
              </a>
              <!-- Product Badge -->
              <div class="absolute top-2 right-2 bg-primary text-white py-1 px-3 rounded-full text-xs font-bold">
                {% if 'amazon' in product.product_url %}
                  Amazon
                {% elif 'flipkart' in product.product_url %}
                  Flipkart
                {% elif 'ebay' in product.product_url %}
                  eBay
                {% else %}
                  Online
                {% endif %}
              </div>
            </div>
            
            <!-- Product Info -->
            <div class="p-5 flex flex-col flex-1">
              <h4 class="text-[1.2rem] font-semibold text-secondary mb-3 leading-snug line-clamp-2"><a href="{% url 'product_detail' product.id %}" class="no-underline text-inherit">{{ product.product_name }}</a></h4>
              
              <!-- Rating -->
              {% if product.rating %}
              <div class="flex items-center mb-3 min-h-6">
                <span class="text-warningc text-lg mr-2">
                  {% for i in "12345" %}
                    {% if forloop.counter <= product.rating|add:0 %}
                      ★
                    {% else %}
                      ☆
                    {% endif %}
                  {% endfor %}
                </span>
                <span class="text-dark text-sm">{{ product.rating }}/5</span>
                {% if product.reviews %}
                  <span class="text-dark text-sm ml-2">({{ product.reviews }})</span>
                {% endif %}
              </div>
              {% endif %}
              
              <!-- Price Section -->
              <div class="bg-light rounded-lg p-4 my-3 min-h-[72px]">
                {% if product.price %}
                <div class="text-[1.8rem] font-bold text-primary mb-1">₹{{ product.price }}</div>
                {% endif %}
                {% if product.original_price %}
                <div>
                  <span class="text-[1.1rem] text-dark line-through mr-2">₹{{ product.original_price }}</span>
                  {% if product.discount %}
                  <span class="bg-successc text-white px-2 py-1 rounded text-xs font-bold">{{ product.discount }} OFF</span>
                  {% endif %}
                </div>
                {% endif %}
              </div>
              
              <!-- Product Details -->
              <div class="my-2 min-h-[90px]">
                {% if product.brand %}
                <div class="flex justify-between py-2 border-b border-borderc text-sm">
                  <span class="font-semibold text-secondary">Brand:</span>
                  <span class="text-dark">{{ product.brand }}</span>
                </div>
                {% endif %}
                {% if product.seller %}
                <div class="flex justify-between py-2 border-b border-borderc text-sm">
                  <span class="font-semibold text-secondary">Seller:</span>
                  <span class="text-dark">{{ product.seller }}</span>
                </div>
                {% endif %}
                {% if product.availability %}
                <div class="flex justify-between py-2 text-sm">
                  <span class="font-semibold text-secondary">Stock:</span>
                  <span class="text-dark">{{ product.availability }}</span>
                </div>
                {% endif %}
              </div>
              
              <!-- Action Buttons -->
              <div class="mt-4">
                <a href="{% url 'product_detail' product.id %}" class="block w-full text-center bg-btn-grad text-white rounded-full py-2.5 font-semibold mb-2 hover:shadow-[0_5px_15px_rgba(255,107,53,0.4)] transition-shadow">
                  <i class="fas fa-info-circle"></i> View Details
                </a>
                <a href="{{ product.product_url }}" target="_blank" class="block w-full text-center bg-light border border-borderc rounded-full py-2.5 font-semibold text-gray-700 hover:bg-borderc transition-colors">
                  <i class="fas fa-external-link-alt"></i> View Product
                </a>
              </div>
              
              <!-- Scraped Time -->
              <div class="text-dark text-xs mt-auto pt-4 border-t border-borderc">
                <i class="fas fa-clock"></i> Scraped: {{ product.scraped_at|date:"M d, Y H:i" }}
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="py-10">
        <div class="bg-white rounded-2xl shadow-card p-10 text-center max-w-3xl mx-auto">
          <div class="text-dark mb-4"><i class="fas fa-shopping-bag text-5xl"></i></div>
          <h3 class="text-2xl font-bold text-secondary mb-3">No products scraped yet!</h3>
          <p class="text-dark mb-6">Start scraping products to build your price comparison collection.</p>
          <a href="/" class="inline-flex items-center bg-btn-grad text-white rounded-full py-3 px-6 font-bold hover:shadow-[0_5px_15px_rgba(255,107,53,0.4)] transition-shadow">
            <i class="fas fa-plus mr-2"></i> Start Scraping
          </a>
        </div>
      </div>
    {% endif %}
  </div>

  <script>
    // Navbar toggle
    document.addEventListener('DOMContentLoaded', function () {
      const toggle = document.getElementById('navToggle');
      const menu = document.getElementById('navbarResponsive');
      if (toggle && menu) {
        toggle.addEventListener('click', function () {
          const isHidden = menu.classList.contains('hidden');
          if (isHidden) {
            menu.classList.remove('hidden');
            toggle.setAttribute('aria-expanded', 'true');
          } else {
            menu.classList.add('hidden');
            toggle.setAttribute('aria-expanded', 'false');
          }
        });
      }
    });

    // Image loading fallback
    document.addEventListener('DOMContentLoaded', function() {
      const images = document.querySelectorAll('.product-image');
      images.forEach(img => {
        img.addEventListener('error', function() {
          this.style.display = 'none';
          const placeholder = this.nextElementSibling;
          if (placeholder) {
            placeholder.style.display = 'flex';
          }
        });
      });
    });
  </script>

</body>

</html>